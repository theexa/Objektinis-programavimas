#include <iostream>
#include <iomanip>
#include <vector>
#include <string>
#include <random>
#include <ctime>
#include <limits>
#include <fstream>
#include <sstream>

using std::cout;
using std::cin;
using std::endl;
using std::string;
using std::vector;
using std::setw;
using std::left;
using std::sort;

struct Studentas {
    string var;
    string pav;
    vector<int> paz;
    int egz;
    double gal;
    double med;
};

//Studentas Stud_iv();
void SkaitytiIsFailo(const string& failoVardas, vector<Studentas>& Grupe);
void IrasytiIFaila(const string& failoVardas, vector<Studentas>& Grupe);

int main() {
    string fpav;
    vector<Studentas> Grupe;

    SkaitytiIsFailo("studentai1000000.txt", Grupe);
    
    std::sort(Grupe.begin(), Grupe.end(), [](const Studentas& a, const Studentas& b) {
        if (a.pav == b.pav)
            return a.var < b.var;
        return a.pav < b.pav;
    });
    
    IrasytiIFaila("Rezultatai1000000.txt", Grupe);
    return 0;
    
}

void SkaitytiIsFailo(const string& failoVardas, vector<Studentas>& Grupe) {
    std::ifstream fd(failoVardas);
    if (!fd.is_open()) {
        cout << "Nepavyko atidaryti failo!" << endl;
        return;
    }

    string eilute;
    getline(fd, eilute);

    while (getline(fd, eilute)) {
        std::istringstream iss(eilute);
        Studentas st;
        iss >> st.pav >> st.var;

        int paz;
        int sum = 0;
        while (iss >> paz) {
            st.paz.push_back(paz);
        }

        st.egz = st.paz.back();
        st.paz.pop_back();

        for (int x : st.paz) sum += x;
        if (!st.paz.empty())
            st.gal = (double)sum / st.paz.size() * 0.4 + st.egz * 0.6;
        else
            st.gal = st.egz * 0.6;

        st.paz.push_back(st.egz);
        sort(st.paz.begin(), st.paz.end());
        if (st.paz.size() % 2 != 0) {
            st.med = st.paz[st.paz.size() / 2];
        }
        else {
            st.med = (st.paz[st.paz.size() / 2] + st.paz[st.paz.size() / 2 - 1]) / 2.0;
        }

        Grupe.push_back(st);
    }
    fd.close();
}

void IrasytiIFaila(const string& failoVardas, vector<Studentas>& Grupe){
    std::ofstream fr(failoVardas);
    fr << "Studento informacija: " << endl;
    fr << setw(15) << left << "Pavarde" << setw(15) << "Vardas"
    << setw(20) << "Galutinis  (Vid.)"
    << setw(20) << "Galutinis (Med.)" << endl;
    for (auto Past : Grupe) {
        fr << setw(15) << left << Past.var
        << setw(15) << Past.pav
        << setw(20) << Past.gal
        << setw(20) << std::setprecision(2) << Past.med << endl;
    }
    fr.close();
}
